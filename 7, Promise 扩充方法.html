<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="author" content="刘亚彬">
		<title>Promise 扩充方法</title>
		<style>
			
		</style>
	</head>
	<body>
		
	</body>
	<script type="text/javascript">
		
		//ES6针对Promise没有定义很多方法,有一些好用的方法还没有在ES6中确定标准,也就是说,Promise本身不存在这些方法,我们不能直接使用,需要用代码扩充方法之后再用
		
		// done 方法
		//扩充的代码:
		Promise.prototype.done = function (onFulfilled, onRejected)
		{
		  this.then(onFulfilled, onRejected)
		    .catch(function (reason) {
		      // 抛出一个全局错误
		      setTimeout(() => { throw reason }, 0);
		    });
		};
		
		
		var p = Promise.resolve('成功的信息')
		p.then(function(){
			return '又成功了'
		}).catch(function(){
			console.log('错误')
			// throw new Error('123')
		}).then(function(){
			return Promise.reject('失败的信息')
		}).done()
		
		
		
		//finally() 方法 : 无论最后是成功还是失败,都会执行这个方法
		// 一般,finally方法中通常做一些清理clean的工作,比如停止加载指示器,关闭数据库,断开http链接等操作


		//扩充的代码
		Promise.prototype.finally = function (callback) {
		  let P = this.constructor;
		  return this.then(
		    value  => P.resolve(callback()).then(() => value),
		    reason => P.resolve(callback()).then(() => { throw reason })
		  );
		};
		
		
		
		var p = Promise.resolve('成功的信息')
//		var p = Promise.reject('失败的信息')
		p.then(function(){
			console.log('成功')
		}).catch(function(){
			console.log('失败')
		}).finally(function(){
			console.log('完成')
		})
		
		
		
		
		
		
		
		
		
	</script>
</html>
